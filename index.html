<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Notenkonferenzen Übersicht</title>

<style>
body {
  font-family: Arial, sans-serif;
  background-color: #fefefe;
  margin: 20px;
}

h1 {
  text-align: center;
  user-select: none;
}

.logo-status-wrapper {
  position: relative;
  height: 70px;
  margin-bottom: 20px;
}

.logo {
  position: absolute;
  left: calc(50% - 260px);
  top: 50%;
  transform: translateY(-50%);
  height: 60px;
}

.start-box {
  position: absolute;
  top: 50%;
  left: calc(50% - 160px);
  transform: translateY(-50%);
  background: #8b0000;
  color: white;
  padding: 10px 20px;
  border-radius: 6px;
  font-weight: bold;
  display: none;
}

.status-text {
  position: absolute;
  top: 50%;
  left: calc(50% - 160px);
  transform: translateY(-50%);
  font-weight: bold;
}

.container {
  max-width: 600px;
  margin: auto;
}

.group-box {
  border: 2px solid #eee;
  border-radius: 8px;
  margin-bottom: 20px;
}

.group-header {
  background: #eee;
  padding: 12px;
  text-align: center;
  font-weight: bold;
}

.group-content {
  padding: 10px 30px;
}

.class-row {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}

.class-label {
  min-width: 100px;
  font-weight: bold;
}

button {
  background: darkred;
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 5px;
  cursor: pointer;
}

button.active {
  background: #e07b7b;
}

button.used {
  background: #ddd;
}

.lock {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 40px;
  opacity: 0;
  cursor: pointer;
}

.lock.unlocked {
  opacity: 0.6;
}

.reset-box {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #e0e0e0;
  padding: 10px 18px;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
  display: none;
  z-index: 9999;
}

#pauseBox {
  top: 70px;
}

@media (max-width: 600px) {
  .start-box { display: none !important; }
  .status-text { max-width: 70%; }
}
</style>
</head>

<body>

<div id="resetBox" class="reset-box" onclick="resetAll()">Zurücksetzen</div>
<div id="pauseBox" class="reset-box" onclick="pauseKonferenz()">⏸ Pause</div>

<h1>Übersicht über die Notenkonferenzen</h1>

<div class="logo-status-wrapper">
  <img src="https://info.marianumlan.de/nachmittagsanmeldung/assets/img/logo2.png" class="logo">
  <div id="startBox" class="start-box"></div>
  <div id="statusText" class="status-text">Die Konferenzen haben noch nicht begonnen.</div>
</div>

<div class="container">
  <div class="group-box">
    <div class="group-header">Konferenzen</div>
    <div class="group-content">
      <div class="class-row">
        <div class="class-label">Klassen</div>
        <button ondblclick="selectClass('5a')">5a</button>
        <button ondblclick="selectClass('5b')">5b</button>
        <button ondblclick="selectClass('6a')">6a</button>
        <button ondblclick="selectClass('6b')">6b</button>
      </div>
    </div>
  </div>
</div>

<img
  src="https://cdn-icons-png.flaticon.com/512/61/61457.png"
  id="lockIcon"
  class="lock"
  ondblclick="toggleLock()"
/>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
firebase.initializeApp({
  databaseURL: "https://notenkonferenzen-default-rtdb.europe-west1.firebasedatabase.app/"
});

const db = firebase.database();

const statusTextEl = document.getElementById("statusText");
const startBoxEl = document.getElementById("startBox");
const lockIcon = document.getElementById("lockIcon");
const resetBox = document.getElementById("resetBox");
const pauseBox = document.getElementById("pauseBox");

let timerInterval;
let unlocked = false;
let currentClass = null;

db.ref().on("value", snap => {
  const data = snap.val() || {};
  const konf = data.konferenz || {};
  clearInterval(timerInterval);

  if (konf.paused) {
    statusTextEl.textContent = "⏸ Konferenz pausiert";
    currentClass = null;
    return;
  }

  if (konf.klasse && konf.startzeit) {
    currentClass = konf.klasse;
    startTimer(new Date(konf.startzeit));
  } else {
    statusTextEl.textContent = "Die Konferenzen haben noch nicht begonnen.";
    currentClass = null;
  }
});

function startTimer(start) {
  timerInterval = setInterval(() => {
    const diff = Math.floor((Date.now() - start) / 1000);
    const min = Math.floor(diff / 60);
    const sec = diff % 60;
    statusTextEl.textContent = `Aktuell in der Konferenz: ${currentClass} (${min} Min ${sec} Sek)`;
  }, 1000);
}

function selectClass(cls) {
  if (!unlocked) return;
  db.ref().update({
    konferenz: {
      klasse: cls,
      startzeit: new Date().toISOString(),
      paused: false
    }
  });
  toggleLock(false);
}

function toggleLock(force = null) {
  unlocked = force !== null ? force : !unlocked;
  lockIcon.classList.toggle("unlocked", unlocked);
  resetBox.style.display = unlocked ? "block" : "none";
  pauseBox.style.display = unlocked ? "block" : "none";
}

function resetAll() {
  if (!unlocked) return;
  db.ref().set({});
  clearInterval(timerInterval);
  statusTextEl.textContent = "Die Konferenzen haben noch nicht begonnen.";
  toggleLock(false);
}

function pauseKonferenz() {
  if (!unlocked || !currentClass) return;
  db.ref("konferenz").update({ paused: true });
  clearInterval(timerInterval);
  statusTextEl.textContent = "⏸ Konferenz pausiert";
}
</script>

</body>
</html>
